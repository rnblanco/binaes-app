"use strict";(self.webpackChunkpk_thunder_frontend=self.webpackChunkpk_thunder_frontend||[]).push([[272],{4272:(q,_,n)=>{n.r(_),n.d(_,{ReservationsModule:()=>k});var r=n(6895),p=n(2248),M=n(9322),d=n(6894),u=n(8203),f=n(9615),m=n(9226),g=n(8683),h=n(9283),e=n(8274),S=n(5722),c=n(433),v=n(5593),R=n(1795),x=n(585),C=n(7011),P=n(3608),w=n(3026);function b(a,o){1&a&&e._UZ(0,"app-loading",3)}function O(a,o){if(1&a){const t=e.EpF();e.TgZ(0,"div",18)(1,"label"),e._uU(2,"Estado:"),e.qZA(),e.TgZ(3,"p-multiSelect",19),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw(2);return e.KtG(l.exemplarStatusSelect.selectedStatus=i)}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("options",t.exemplarStatusSelect.status)("ngModel",t.exemplarStatusSelect.selectedStatus)("showToggleAll",!1)("resetFilterOnHide",!0)("disabled",!0)}}function U(a,o){if(1&a){const t=e.EpF();e.TgZ(0,"div",18)(1,"label"),e._uU(2,"Reservado:"),e.qZA(),e.TgZ(3,"p-calendar",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw(2);return e.KtG(l.reservationDate=i)}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled",!0)("ngModel",t.reservationDate)("selectOtherMonths",!0)}}function D(a,o){if(1&a){const t=e.EpF();e.TgZ(0,"div",21)(1,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.delete())}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("loading",t.deleteLoading)}}const y=function(a){return{"p-sm-12":a}},N=function(a,o){return{"p-col-6 p-sm-9":a,"p-col-12":o}};function L(a,o){if(1&a){const t=e.EpF();e.TgZ(0,"form",4,5)(2,"div",6)(3,"label"),e._uU(4,"Ejemplar:"),e.qZA(),e.TgZ(5,"p-multiSelect",7,8),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.selectedExemplar=i)})("onFilter",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.exemplarFilter(i))})("onChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.exemplarChange(i))}),e.qZA()(),e.TgZ(7,"div",6)(8,"label"),e._uU(9,"Usuario:"),e.qZA(),e.TgZ(10,"p-multiSelect",9,10),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.selectedUser=i)})("onFilter",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.userFilter(i))})("onChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.userChange(i))}),e.qZA()(),e.TgZ(12,"div",11)(13,"label"),e._uU(14,"Rango de fechas:"),e.qZA(),e.TgZ(15,"p-calendar",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.dates=i)})("onSelect",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDateChange())}),e.qZA()(),e.YNc(16,O,4,5,"div",13),e.YNc(17,U,4,3,"div",13),e.TgZ(18,"div",14)(19,"div",15)(20,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.add())}),e.ALo(21,"addOrEdit"),e.qZA()(),e.YNc(22,D,2,1,"div",17),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(5),e.Q6J("options",t.exemplarSelect.exemplars)("ngModel",t.exemplarSelect.selectedExemplar)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!t.isNew),e.xp6(5),e.Q6J("options",t.userSelect.users)("ngModel",t.userSelect.selectedUser)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!t.isNew),e.xp6(2),e.Q6J("ngClass",e.VKq(30,y,t.isNew)),e.xp6(3),e.s9C("pTooltip",t.isNew?"":"Si desea editar debe hacerlo desde Pr\xe9stamos"),e.Q6J("ngModel",t.dates)("minDate",t.minDate)("maxDate",t.maxDate)("disabledDates",t.disabledDates)("disabled",!t.isNew)("selectOtherMonths",!0),e.xp6(1),e.Q6J("ngIf",!t.isNew),e.xp6(1),e.Q6J("ngIf",!t.isNew),e.xp6(2),e.Q6J("ngClass",e.WLB(32,N,t.user.id_rolUsuario===t.SUPER_ADMIN&&!t.isNew,t.isNew||t.user.id_rolUsuario!==t.SUPER_ADMIN)),e.xp6(1),e.s9C("pTooltip",t.isNew?"":"Si desea editar debe hacerlo desde Pr\xe9stamos"),e.Q6J("loading",t.addLoading)("label",e.lcZ(21,28,t.isNew))("disabled",!t.formIsValid||!t.isNew),e.xp6(2),e.Q6J("ngIf",t.user.id_rolUsuario===t.SUPER_ADMIN&&!t.isNew)}}let E=(()=>{class a extends M.H{constructor(t,s,i,l){super(),this.route=t,this.exemplarSelect=s,this.userSelect=i,this.exemplarStatusSelect=l,this.SUPER_ADMIN=d.G.SUPER_ADMIN,this.isNew=!0,this.dates=[],this.disabledDates=[],this.minDate=new Date,this.addLoading=!1,this.deleteLoading=!1}ngOnInit(){this.userSelect=new g.q,this.exemplarSelect=new m.D,this.exemplarStatusSelect=new h.a,this.loadAll(),this.user=this.authService.storagedUser,this.breadcrumbService.setItems(this.getBreadCrumbs())}get formIsValid(){return this.userSelect.selectedUser?.length>0&&this.exemplarSelect.selectedExemplar?.length>0&&null!==this.dates[0]&&null!==this.dates[1]}loadAll(){this.user.ROLUSUARIO.id_rolUsuario===d.G.USER&&(this.messageService.setPayload({type:"warn",title:"Error",body:"No tienes autorizaci\xf3n para ver esta informaci\xf3n"}),setTimeout(()=>{this.router.navigate([u.u.reservationsPage])},50)),this.subscription.add(this.route.params.subscribe(({id:t})=>{this.loading=!0,this.exemplarSelect.loadExemplars(),this.userSelect.loadUsers(),this.exemplarStatusSelect.loadStatus(),t?(this.id=t,this.loadInfo()):this.loading=!1}))}add(){this.isNew?(this.addLoading=!0,this.subscription.add(this.catalogService.addOfURL("RESERVA",{fh_Reserva:new Date,PRESTAMO:{fh_Prestamo:this.dates[0],fh_Devolucion:this.dates[1],id_Estado:f.u.RESERVADO,id_usuarioPresta:this.userSelect.selectedUser[0],id_Ejemplar:this.exemplarSelect.selectedExemplar[0]}}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La reserva fue a\xf1adida satifactoriamente"}),setTimeout(()=>{this.router.navigate([u.u.reservationsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo a\xf1adir la reserva"}),this.addLoading=!1}))):this.update()}update(){this.addLoading=!0,this.subscription.add(this.catalogService.updateOfURL(`RESERVA/${this.id}`,{id_Reserva:this.id,fh_Reserva:this.reservationDate,PRESTAMO:{id_Prestamo:this.idBorrow,fh_Prestamo:this.dates[0],fh_Devolucion:this.dates[1],id_Estado:this.exemplarStatusSelect.selectedStatus[0],id_usuarioPresta:this.userSelect.selectedUser[0],id_Ejemplar:this.exemplarSelect.selectedExemplar[0]}}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La reserva fue editado satifactoriamente"}),setTimeout(()=>{this.router.navigate([u.u.reservationsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo editar la reserva"}),this.addLoading=!1}))}delete(){this.deleteLoading=!0,this.subscription.add(this.catalogService.deleteOfURL(`RESERVA/${this.id}`).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La reserva fue eliminada con \xe9xito"}),setTimeout(()=>{this.router.navigate([u.u.reservationsPage])},200),this.deleteLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo eliminar la reserva"}),this.deleteLoading=!1}))}loadInfo(){this.subscription.add(this.catalogService.getByNameWithParams(`RESERVA/${this.id}`).subscribe(t=>{t&&(this.isNew=!1),this.reservation=t,this.id=t.id_Reserva,this.idBorrow=t.PRESTAMO.id_Prestamo,this.dates=[new Date(t.PRESTAMO.fh_Prestamo),new Date(t.PRESTAMO.fh_Devolucion)],this.reservationDate=new Date(t.fh_Reserva),this.minDate=new Date(t.PRESTAMO.fh_Prestamo)>this.minDate?this.minDate:new Date(t.PRESTAMO.fh_Prestamo),this.userSelect.selectedUser=[t.PRESTAMO.USUARIO.id_Usuario],this.exemplarSelect.selectedExemplar=[t.PRESTAMO.EJEMPLAR.id_Ejemplar],this.exemplarStatusSelect.selectedStatus=[t.PRESTAMO.ESTADOS.id_Estado],this.exemplarStatusSelect.loadedStatus=t.PRESTAMO.ESTADOS.id_Estado,setTimeout(()=>{this.loading=!1},200)},()=>{this.loading=!1,this.router.navigate([u.u.reservationsPage])}))}onDateChange(){if(null===this.dates[0]||null===this.dates[1])return;this.isNew||(this.exemplarStatusSelect.selectedStatus=this.dates[1].getDate()===(new Date).getDate()?[f.u.FINALIZADO]:[this.exemplarStatusSelect.loadedStatus]);let t=[];const s=new Date(this.dates[0].getTime());for(;this.dates[1]>s||this.dates[1].getDate()===s.getDate();)t.push(new Date(s.getDate())),s.setDate(s.getDate()+1);t.forEach(i=>{this.disabledDates.forEach(l=>{i.getDate()!==l.getDate()||(this.dates=[])})})}getBreadCrumbs(){return[{label:"Reservas",routerLink:[this.routeInformation.reservationsPage]},{label:"Reserva",routerLink:[this.routeInformation.reservationPage]}]}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(p.gz),e.Y36(m.D),e.Y36(g.q),e.Y36(h.a))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-reservation-page"]],features:[e.qOj],decls:3,vars:2,consts:[[1,"card","p-mt-4"],["class","p-d-flex p-ai-center p-jc-center","style","height: 80%",4,"ngIf"],["autocomplete","off","class","p-fluid p-formgrid p-grid p-formgrid-sm p-ml-2 p-mr-2",4,"ngIf"],[1,"p-d-flex","p-ai-center","p-jc-center",2,"height","80%"],["autocomplete","off",1,"p-fluid","p-formgrid","p-grid","p-formgrid-sm","p-ml-2","p-mr-2"],["form","ngForm"],[1,"p-field","p-col-12","p-mt-2"],["name","selectedType","defaultLabel","Elige un ejemplar","optionLabel","nombre","optionValue","id_Ejemplar","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],["exemplarMultiSelect",""],["name","selectedUser","defaultLabel","Elige un usuario","optionLabel","nombre","optionValue","id_Usuario","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],["userMultiSelect",""],[1,"p-field","p-col-12","p-sm-6","p-mt-2",3,"ngClass"],["selectionMode","range","name","dates","dateFormat","dd/mm/yy","placeholder","Elige un rango de fechas para tu reserva","tooltipPosition","top",3,"ngModel","minDate","maxDate","disabledDates","disabled","pTooltip","selectOtherMonths","ngModelChange","onSelect"],["class","p-field p-col-12 p-sm-3 p-mt-2",4,"ngIf"],[1,"p-col-12","p-grid","p-mt-4","p-mt-2","p-ml-0","p-mr-0","p-pl-0","p-pr-0"],[1,"p-field",3,"ngClass"],["pButton","","pRipple","","type","button","tooltipPosition","top",1,"p-button-success",3,"loading","label","pTooltip","disabled","click"],["class","p-field p-col-6 p-sm-3",4,"ngIf"],[1,"p-field","p-col-12","p-sm-3","p-mt-2"],["name","selectedStatus","defaultLabel","Elige un estado","optionLabel","estado","optionValue","id_Estado","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","resetFilterOnHide","disabled","ngModelChange"],["name","reservationDate","dateFormat","dd/mm/yy",3,"disabled","ngModel","selectOtherMonths","ngModelChange"],[1,"p-field","p-col-6","p-sm-3"],["pButton","","pRipple","","type","button","label","Eliminar","icon","pi pi-trash",1,"p-button-danger",3,"loading","click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.YNc(1,b,1,0,"app-loading",1),e.YNc(2,L,23,35,"form",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",s.loading),e.xp6(1),e.Q6J("ngIf",!s.loading))},dependencies:[r.mk,r.O5,S.NU,c._Y,c.JJ,c.JL,c.On,c.F,v.Hq,R.H,x.f,C.N,P.u,w.p],encapsulation:2}),a})();var J=n(9908),Z=n(414),I=n(805),T=n(7147);function F(a,o){if(1&a&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.lcZ(2,1,null==t||null==t.PRESTAMO||null==t.PRESTAMO.EJEMPLAR?null:t.PRESTAMO.EJEMPLAR.nombre)," ")}}function Q(a,o){if(1&a&&(e.ynx(0),e._UZ(1,"p-chip",7),e.ALo(2,"titlecase"),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(1),e.Q6J("image","assets/images/icons/user-circle.png")("label",e.lcZ(2,2,null==t||null==t.PRESTAMO.USUARIO?null:t.PRESTAMO.USUARIO.nombre))}}function B(a,o){if(1&a&&(e.ynx(0),e.TgZ(1,"div",8)(2,"span"),e._uU(3),e.ALo(4,"titlecase"),e.qZA()(),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(2),e.Gre("'p-pt-1 p-pb-1 status-badge ",null==t||null==t.PRESTAMO||null==t.PRESTAMO.ESTADOS?null:t.PRESTAMO.ESTADOS.estado,""),e.xp6(1),e.Oqu(e.lcZ(4,4,null==t||null==t.PRESTAMO||null==t.PRESTAMO.ESTADOS?null:t.PRESTAMO.ESTADOS.estado))}}function H(a,o){if(1&a&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.xi3(2,1,null==t?null:t.fh_Reserva,"dd/MM/yyyy")," ")}}function j(a,o){if(1&a&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.xi3(2,1,null==t||null==t.PRESTAMO?null:t.PRESTAMO.fh_Prestamo,"dd/MM/yyyy")," ")}}function G(a,o){if(1&a&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&a){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.xi3(2,1,null==t||null==t.PRESTAMO?null:t.PRESTAMO.fh_Devolucion,"dd/MM/yyyy")," ")}}function Y(a,o){if(1&a&&(e.ynx(0),e._uU(1),e.BQk()),2&a){const t=e.oxw().$implicit,s=e.oxw().rowData;e.xp6(1),e.hij(" ",s[t.field]," ")}}function K(a,o){if(1&a&&(e.TgZ(0,"td",4),e.YNc(1,F,3,3,"ng-container",5),e.YNc(2,Q,3,4,"ng-container",5),e.YNc(3,B,5,6,"ng-container",5),e.YNc(4,H,3,4,"ng-container",5),e.YNc(5,j,3,4,"ng-container",5),e.YNc(6,G,3,4,"ng-container",5),e.YNc(7,Y,2,1,"ng-container",6),e.qZA()),2&a){const t=o.$implicit;e.Udp("width",t.width,"px"),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","PRESTAMO.EJEMPLAR.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","PRESTAMO.USUARIO.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","PRESTAMO.ESTADOS.estado"),e.xp6(1),e.Q6J("ngSwitchCase","fh_Reserva"),e.xp6(1),e.Q6J("ngSwitchCase","PRESTAMO.fh_Prestamo"),e.xp6(1),e.Q6J("ngSwitchCase","PRESTAMO.fh_Devolucion")}}function V(a,o){1&a&&e.YNc(0,K,8,9,"td",3),2&a&&e.Q6J("ngForOf",o.columns)}const z=[{path:"",component:(()=>{class a extends J.c{constructor(){super(),this.USER=d.G.USER,this.cols=[{field:"PRESTAMO.EJEMPLAR.nombre",header:"Nombre",width:125},{field:"PRESTAMO.USUARIO.nombre",header:"Usuario",width:125},{field:"PRESTAMO.ESTADOS.estado",header:"Estado",width:100},{field:"fh_Reserva",header:"Reserva",width:100},{field:"PRESTAMO.fh_Prestamo",header:"Pr\xe9stamo",width:100},{field:"PRESTAMO.fh_Devolucion",header:"Devoluci\xf3n",width:100}]}ngOnInit(){this.user.id_rolUsuario===d.G.USER?this.loadOwn():this.loadAll(),this.breadcrumbService.setItems(this.getBreadCrumbs())}loadOwn(){this.list=[],this.loading=!0,this.getPaginationParams(),this.subscription.add(this.catalogService.getByNameWithParams("RESERVA",this.httpParams.set("id_rolUsuario",this.user.ROLUSUARIO.id_rolUsuario).set("id_Usuario",this.user.id_Usuario)).subscribe(t=>{this.pagination=t.meta,this.currentPage=this.pagination.currentPage,this.list=t.data,this.loading=!1},()=>this.loading=!1))}loadAll(){this.list=[],this.loading=!0,this.getPaginationParams(),this.subscription.add(this.catalogService.getByNameWithParams("RESERVA",this.httpParams.set("id_rolUsuario",this.user.ROLUSUARIO.id_rolUsuario).set("id_Usuario",this.user.id_Usuario)).subscribe(t=>{this.pagination=t.meta,this.currentPage=this.pagination.currentPage,this.list=t.data,this.loading=!1},()=>this.loading=!1))}onLazyLoad(t){this.paginate(t),this.loadAll()}onNew(){this.user.id_rolUsuario!==d.G.USER&&this.router.navigate([`${this.routeInformation.reservationPage}/`])}onRowSelect({data:t}){this.user.id_rolUsuario!==d.G.USER&&this.router.navigate([`${this.routeInformation.reservationPage}/${t.id_Reserva}/`])}getBreadCrumbs(){return[{label:this.user.id_rolUsuario===this.USER?"Mis reservas":"Reservas",routerLink:[this.routeInformation.reservationsPage]}]}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-reservations-page"]],features:[e.qOj],decls:3,vars:8,consts:[[1,"p-mt-4"],["newButtonLabel","Nueva reserva","type","reservas",3,"reloading","globalFilter","rows","pagination","loading","cols","list","showNewButton","onLazyLoad","onRowSelect","onNewClick"],["pTemplate","body"],["class","text-center",3,"ngSwitch","width",4,"ngFor","ngForOf"],[1,"text-center",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["styleClass","p-col-12",3,"image","label"],[1,"text-center"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"table-card",1),e.NdJ("onLazyLoad",function(l){return s.onLazyLoad(l)})("onRowSelect",function(l){return s.onRowSelect(l)})("onNewClick",function(){return s.onNew()}),e.YNc(2,V,1,1,"ng-template",2),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("reloading",s.loading)("globalFilter",s.globalFilter)("rows",s.rows)("pagination",s.pagination)("loading",s.loading)("cols",s.cols)("list",s.list)("showNewButton",s.user.id_rolUsuario!==s.USER))},dependencies:[r.sg,r.RF,r.n9,r.ED,Z.r,I.jx,T.A,r.rS,r.uU],encapsulation:2}),a})()},{path:"reservation",component:E},{path:"reservation/:id",component:E}];let $=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[p.Bz.forChild(z),p.Bz]}),a})();var W=n(6311),A=n(4466),X=n(9423);let k=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({providers:[g.q,m.D,h.a],imports:[r.ez,$,W.j,A.m,S.q4,c.u5,v.hJ,R.T,A.m,x._8,X.I,P.z,T.o]}),a})()}}]);