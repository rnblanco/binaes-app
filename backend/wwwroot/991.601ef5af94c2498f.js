"use strict";(self.webpackChunkpk_thunder_frontend=self.webpackChunkpk_thunder_frontend||[]).push([[991],{8991:(k,m,n)=>{n.r(m),n.d(m,{VisitsModule:()=>X});var r=n(6895),u=n(2248),b=n(2959),c=n(8203),g=n(6894),e=n(8274),d=n(433),p=n(805),h=n(5593),f=n(1795),_=n(5722),A=n(7011),v=n(585);const C=["areaMultiSelect"];function S(i,s){1&i&&e._UZ(0,"app-loading",3)}function y(i,s){if(1&i&&e._UZ(0,"button",16),2&i){const t=e.oxw(2);e.MGl("label","Agregar '",t.userText,"'"),e.Q6J("disabled",!0)}}function T(i,s){if(1&i&&e._UZ(0,"button",16),2&i){const t=e.oxw(2);e.MGl("label","Agregar '",t.areaText,"'"),e.Q6J("disabled",!0)}}function P(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",11)(1,"label"),e._uU(2,"Hora de salida:"),e.qZA(),e.TgZ(3,"p-calendar",17),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.fh_salida=o)}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("timeOnly",!0)("ngModel",t.fh_salida)("disabled",!0)}}function w(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",11)(1,"label"),e._uU(2,"Fecha de visita:"),e.qZA(),e.TgZ(3,"p-calendar",18),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.visitDate=o)}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled",!0)("ngModel",t.visitDate)}}function U(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",19)(1,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.delete())}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("loading",t.deleteLoading)}}function V(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"form",4,5)(2,"div",6)(3,"label"),e._uU(4,"Nombre de usuario:"),e.qZA(),e.TgZ(5,"p-multiSelect",7,8),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.selectedUser=o)})("onFilter",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.userFilter(o))})("onChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.userChange(o))}),e.YNc(7,y,1,2,"ng-template",9),e.qZA()(),e.TgZ(8,"div",6)(9,"label"),e._uU(10,"\xc1rea seleccionada:"),e.qZA(),e.TgZ(11,"p-multiSelect",10,8),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.selectedArea=o)})("onFilter",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.areaFilter(o))})("onChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.areaChange(o))}),e.YNc(13,T,1,2,"ng-template",9),e.qZA()(),e.TgZ(14,"div",11)(15,"label"),e._uU(16,"Hora de entrada:"),e.qZA(),e.TgZ(17,"p-calendar",12),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.fh_entrada=o)}),e.qZA()(),e.YNc(18,P,4,3,"div",13),e.YNc(19,w,4,2,"div",13),e.TgZ(20,"div",14),e.YNc(21,U,2,1,"div",15),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(5),e.Q6J("options",t.users)("ngModel",t.selectedUser)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!0),e.xp6(6),e.Q6J("options",t.areas)("ngModel",t.selectedArea)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!0),e.xp6(6),e.Q6J("disabled",!0)("timeOnly",!0)("ngModel",t.fh_entrada),e.xp6(1),e.Q6J("ngIf",!t.isNew),e.xp6(1),e.Q6J("ngIf",!t.isNew),e.xp6(2),e.Q6J("ngIf",t.user.id_rolUsuario===t.SUPER_ADMIN&&!t.isNew)}}let x=(()=>{class i extends b.H{constructor(t){super(),this.route=t,this.SUPER_ADMIN=g.G.SUPER_ADMIN,this.isNew=!0,this.addLoading=!1,this.deleteLoading=!1,this.areaText="",this.selectedArea=[],this.userText="",this.selectedUser=[]}get formIsValid(){return this.selectedArea?.length>0&&this.selectedUser?.length>0}ngOnInit(){this.loadAll(),this.user=this.authService.storagedUser,this.breadcrumbService.setItems(this.getBreadCrumbs())}loadAll(){this.user.id_rolUsuario===g.G.USER&&(this.messageService.setPayload({type:"warn",title:"Error",body:"No tienes autorizaci\xf3n para ver esta informaci\xf3n"}),setTimeout(()=>{this.router.navigate([c.u.visitsPage])},50)),this.subscription.add(this.route.params.subscribe(({id:t})=>{this.loading=!0,this.loadAreas(),this.loadUsers(),t?(this.id=t,this.loadInfo()):this.loading=!1}))}delete(){this.deleteLoading=!0,this.subscription.add(this.catalogService.deleteOfURL(`VISITAS/${this.id}`).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La visita fue eliminada con \xe9xito"}),setTimeout(()=>{this.router.navigate([c.u.visitsPage])},200),this.deleteLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo eliminar la visita"}),this.deleteLoading=!1}))}add(){this.isNew?(this.addLoading=!0,this.subscription.add(this.catalogService.addOfURL("VISITAS",{id_Visita:this.id,fh_entrada:this.fh_entrada,fh_salida:this.fh_salida,id_Usuario:this.selectedUser[0],id_Area:this.selectedArea[0]}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La visita fue a\xf1adida satifactoriamente"}),setTimeout(()=>{this.router.navigate([c.u.visitsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo a\xf1adir la visita"}),this.addLoading=!1}))):this.update()}update(){this.addLoading=!0,this.subscription.add(this.catalogService.updateOfURL(`VISITAS/${this.id}`,{id_Visita:this.id,fh_entrada:this.fh_entrada,fh_salida:this.fh_salida,id_Usuario:this.selectedUser[0],id_Area:this.selectedArea[0]}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"La visita fue editada satifactoriamente"}),setTimeout(()=>{this.router.navigate([c.u.visitsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo editar la visita"}),this.addLoading=!1}))}loadInfo(){this.subscription.add(this.catalogService.getByNameWithParams(`VISITAS/${this.id}`).subscribe(t=>{t.id_Visita&&(this.isNew=!1),this.fh_entrada=new Date(t.fh_entrada),this.fh_salida=new Date(t.fh_salida),this.visitDate=new Date(t.fh_entrada),this.selectedArea=[t.AREA.id_Area],this.selectedUser=[t.USUARIO.id_Usuario],setTimeout(()=>{this.loading=!1},200)},()=>{this.loading=!1,this.router.navigate([c.u.collectionPage])}))}userFilter(t){this.userText=t.filter}userChange(t){this.selectedUser=[t.itemValue]}loadUsers(){this.subscription.add(this.catalogService.getByNameWithParams("USUARIO").subscribe(t=>{this.users=t}))}areaFilter(t){this.areaText=t.filter}areaChange(t){this.selectedArea=[t.itemValue]}loadAreas(){this.subscription.add(this.catalogService.getByNameWithParams("AREA").subscribe(t=>{this.areas=t}))}getBreadCrumbs(){return[{label:"Visitas",routerLink:[this.routeInformation.visitsPage]},{label:"Visita",routerLink:[this.routeInformation.visitPage]}]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-visit-page"]],viewQuery:function(t,a){if(1&t&&(e.Gf(C,5),e.Gf(C,5)),2&t){let o;e.iGM(o=e.CRH())&&(a.areaMultiSelect=o.first),e.iGM(o=e.CRH())&&(a.userMultiSelect=o.first)}},features:[e.qOj],decls:3,vars:2,consts:[[1,"card","p-mt-4"],["class","p-d-flex p-ai-center p-jc-center","style","height: 80%",4,"ngIf"],["autocomplete","off","class","p-fluid p-formgrid p-grid p-formgrid-sm p-ml-2 p-mr-2",4,"ngIf"],[1,"p-d-flex","p-ai-center","p-jc-center",2,"height","80%"],["autocomplete","off",1,"p-fluid","p-formgrid","p-grid","p-formgrid-sm","p-ml-2","p-mr-2"],["form","ngForm"],[1,"p-field","p-col-12","p-mt-2"],["name","selectedUser","defaultLabel","Elige un usuario","optionLabel","nombre","optionValue","id_Usuario",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],["areaMultiSelect",""],["pTemplate","emptyfilter"],["name","selectedArea","defaultLabel","Elige un \xe1rea","optionLabel","nombre","optionValue","id_Area",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],[1,"p-field","p-col-4","p-mt-2"],["name","fh_entrada","dateFormat","dd/mm/yy","hourFormat","12",3,"disabled","timeOnly","ngModel","ngModelChange"],["class","p-field p-col-4 p-mt-2",4,"ngIf"],[1,"p-col-12","p-grid","p-mt-2","p-ml-0","p-mr-0","p-pl-0","p-pr-0"],["class","p-field","class","p-col-12",4,"ngIf"],["pButton","","pRipple","","type","button",1,"p-button-primary",3,"label","disabled"],["name","fh_salida","dateFormat","dd/mm/yy","hourFormat","12",3,"timeOnly","ngModel","disabled","ngModelChange"],["name","visitDate","dateFormat","dd/mm/yy",3,"disabled","ngModel","ngModelChange"],[1,"p-col-12"],["pButton","","pRipple","","type","button","label","Eliminar","icon","pi pi-trash",1,"p-button-danger",3,"loading","click"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0),e.YNc(1,S,1,0,"app-loading",1),e.YNc(2,V,22,18,"form",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",a.loading),e.xp6(1),e.Q6J("ngIf",!a.loading))},dependencies:[r.O5,d._Y,d.JJ,d.JL,d.On,d.F,p.jx,h.Hq,f.H,_.NU,A.N,v.f],encapsulation:2}),i})();var M=n(9908),N=n(414);function L(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&i){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.lcZ(2,1,null==t||null==t.USUARIO?null:t.USUARIO.nombre)," ")}}function I(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&i){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.lcZ(2,1,null==t||null==t.AREA?null:t.AREA.nombre)," ")}}function F(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.BQk()),2&i){const t=e.oxw(2).rowData;e.xp6(1),e.AsE(" ",e.gM2(2,2,null==t?null:t.fh_entrada,"h:mm a","","en-US")," ",e.xi3(3,7,null==t?null:t.fh_entrada,"dd-MM-yyyy")," ")}}function R(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.BQk()),2&i){const t=e.oxw(2).rowData;e.xp6(1),e.AsE(" ",e.gM2(2,2,null==t?null:t.fh_salida,"h:mm a","","en-US")," ",e.xi3(3,7,null==t?null:t.fh_salida,"dd-MM-yyyy")," ")}}function Z(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&i){const t=e.oxw().$implicit,a=e.oxw().rowData;e.xp6(1),e.hij(" ",e.lcZ(2,1,a[t.field])," ")}}function J(i,s){if(1&i&&(e.TgZ(0,"td",4),e.YNc(1,L,3,3,"ng-container",5),e.YNc(2,I,3,3,"ng-container",5),e.YNc(3,F,4,10,"ng-container",5),e.YNc(4,R,4,10,"ng-container",5),e.YNc(5,Z,3,3,"ng-container",6),e.qZA()),2&i){const t=s.$implicit;e.Udp("width",t.width,"px"),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","USUARIO.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","AREA.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","fh_entrada"),e.xp6(1),e.Q6J("ngSwitchCase","fh_salida")}}function E(i,s){1&i&&e.YNc(0,J,6,7,"td",3),2&i&&e.Q6J("ngForOf",s.columns)}const O=[{path:"",component:(()=>{class i extends M.c{constructor(){super(),this.USER=g.G.USER,this.cols=[{field:"USUARIO.nombre",header:"Nombre del visitante",width:100},{field:"AREA.nombre",header:"Nombre del \xe1rea",width:100},{field:"fh_entrada",header:"Entrada",width:100},{field:"fh_salida",header:"Salida",width:10}]}ngOnInit(){this.loadAll(),this.user=this.authService.storagedUser,this.breadcrumbService.setItems(this.getBreadCrumbs())}loadAll(){this.list=[],this.loading=!0,this.getPaginationParams(),this.subscription.add(this.catalogService.getByNameWithParams("VISITAS",this.httpParams).subscribe(t=>{this.pagination=t.meta,this.currentPage=this.pagination.currentPage,this.list=t.data,this.loading=!1},()=>this.loading=!1))}onLazyLoad(t){this.paginate(t),this.loadAll()}onNew(){this.user.id_rolUsuario!==g.G.USER&&this.router.navigate([`${this.routeInformation.visitPage}/`])}onRowSelect({data:t}){this.user.id_rolUsuario!==g.G.USER&&this.router.navigate([`${this.routeInformation.visitPage}/${t.id_Visita}/`])}getBreadCrumbs(){return[{label:"Visitas",routerLink:[this.routeInformation.visitPage]}]}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-visits-page"]],features:[e.qOj],decls:3,vars:8,consts:[[1,"p-mt-4"],["newButtonLabel","Ingresar visita","type","visitas",3,"reloading","globalFilter","rows","pagination","loading","cols","list","showNewButton","onLazyLoad","onRowSelect","onNewClick"],["pTemplate","body"],["class","text-center",3,"ngSwitch","width",4,"ngFor","ngForOf"],[1,"text-center",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"table-card",1),e.NdJ("onLazyLoad",function(l){return a.onLazyLoad(l)})("onRowSelect",function(l){return a.onRowSelect(l)})("onNewClick",function(){return a.onNew()}),e.YNc(2,E,1,1,"ng-template",2),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("reloading",a.loading)("globalFilter",a.globalFilter)("rows",a.rows)("pagination",a.pagination)("loading",a.loading)("cols",a.cols)("list",a.list)("showNewButton",!1))},dependencies:[r.sg,r.RF,r.n9,r.ED,N.r,p.jx,r.rS,r.uU],encapsulation:2}),i})()},{path:"visit",component:x},{path:"visit/:id",component:x}];let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.Bz.forChild(O),u.Bz]}),i})();var B=n(6311),G=n(1740),H=n(8433),D=n(4466),Y=n(9423),j=n(3388),z=n(529),K=n(5047),$=n(3054),W=n(8783);let X=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[r.ez,Q,B.j,d.u5,G.j,H.ON,h.hJ,f.T,_.q4,D.m,Y.I,v._8,j.O,z.JF,K.L$,$.A,W.LU]}),i})()}}]);