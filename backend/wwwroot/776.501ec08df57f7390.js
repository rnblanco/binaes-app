"use strict";(self.webpackChunkpk_thunder_frontend=self.webpackChunkpk_thunder_frontend||[]).push([[776],{3776:(X,u,i)=>{i.r(u),i.d(u,{BorrowsModule:()=>W});var r=i(6895),m=i(2248),d=i(6894),v=i(9908),e=i(8274),U=i(414),T=i(805),g=i(7147);function A(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&o){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.lcZ(2,1,null==t||null==t.EJEMPLAR?null:t.EJEMPLAR.nombre)," ")}}function M(o,n){if(1&o&&(e.ynx(0),e._UZ(1,"p-chip",7),e.ALo(2,"titlecase"),e.BQk()),2&o){const t=e.oxw(2).rowData;e.xp6(1),e.Q6J("image","assets/images/icons/user-circle.png")("label",e.lcZ(2,2,null==t||null==t.USUARIO?null:t.USUARIO.nombre))}}function y(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"div",8)(2,"span"),e._uU(3),e.ALo(4,"titlecase"),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2).rowData;e.xp6(2),e.Gre("'p-pt-1 p-pb-1 status-badge ",null==t||null==t.ESTADOS?null:t.ESTADOS.estado,""),e.xp6(1),e.Oqu(e.lcZ(4,4,null==t||null==t.ESTADOS?null:t.ESTADOS.estado))}}function B(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&o){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.xi3(2,1,t.fh_Prestamo,"dd/MM/yyyy")," ")}}function D(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&o){const t=e.oxw(2).rowData;e.xp6(1),e.hij(" ",e.xi3(2,1,t.fh_Devolucion,"dd/MM/yyyy")," ")}}function N(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw().$implicit,a=e.oxw().rowData;e.xp6(1),e.hij(" ",a[t.field]," ")}}function L(o,n){if(1&o&&(e.TgZ(0,"td",4),e.YNc(1,A,3,3,"ng-container",5),e.YNc(2,M,3,4,"ng-container",5),e.YNc(3,y,5,6,"ng-container",5),e.YNc(4,B,3,4,"ng-container",5),e.YNc(5,D,3,4,"ng-container",5),e.YNc(6,N,2,1,"ng-container",6),e.qZA()),2&o){const t=n.$implicit;e.Udp("width",t.width,"px"),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","EJEMPLAR.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","USUARIO.nombre"),e.xp6(1),e.Q6J("ngSwitchCase","ESTADOS.estado"),e.xp6(1),e.Q6J("ngSwitchCase","fh_Prestamo"),e.xp6(1),e.Q6J("ngSwitchCase","fh_Devolucion")}}function R(o,n){1&o&&e.YNc(0,L,7,8,"td",3),2&o&&e.Q6J("ngForOf",n.columns)}let O=(()=>{class o extends v.c{constructor(){super(),this.USER=d.G.USER,this.cols=[{field:"EJEMPLAR.nombre",header:"Nombre",width:125},{field:"USUARIO.nombre",header:"Usuario",width:125},{field:"ESTADOS.estado",header:"Estado",width:100},{field:"fh_Prestamo",header:"Pr\xe9stamo",width:100},{field:"fh_Devolucion",header:"Devoluci\xf3n",width:100}]}ngOnInit(){this.user.id_rolUsuario===d.G.USER?this.loadOwn():this.loadAll(),this.breadcrumbService.setItems(this.getBreadCrumbs())}loadOwn(){this.list=[],this.loading=!0,this.getPaginationParams(),this.subscription.add(this.catalogService.getByNameWithParams("PRESTAMO",this.httpParams.set("id_rolUsuario",this.user.ROLUSUARIO.id_rolUsuario).set("id_Usuario",this.user.id_Usuario)).subscribe(t=>{this.pagination=t.meta,this.currentPage=this.pagination.currentPage,this.list=t.data,this.loading=!1},()=>this.loading=!1))}loadAll(){this.list=[],this.loading=!0,this.getPaginationParams(),this.subscription.add(this.catalogService.getByNameWithParams("PRESTAMO",this.httpParams.set("id_rolUsuario",this.user.ROLUSUARIO.id_rolUsuario).set("id_Usuario",this.user.id_Usuario)).subscribe(t=>{this.pagination=t.meta,this.currentPage=this.pagination.currentPage,this.list=t.data,this.loading=!1},()=>this.loading=!1))}onLazyLoad(t){this.paginate(t),this.loadAll()}onNew(){this.user.id_rolUsuario!==d.G.USER&&this.router.navigate([`${this.routeInformation.borrowPage}/`])}onRowSelect({data:t}){this.user.id_rolUsuario!==d.G.USER&&this.router.navigate([`${this.routeInformation.borrowPage}/${t.id_Prestamo}/`])}getBreadCrumbs(){return[{label:this.user.id_rolUsuario===this.USER?"Mis pr\xe9stamos":"Pr\xe9stamos",routerLink:[this.routeInformation.borrowsPage]}]}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-borrows-page"]],features:[e.qOj],decls:3,vars:8,consts:[[1,"p-mt-4"],["newButtonLabel","Nuevo pr\xe9stamo","type","pr\xe9stamos",3,"reloading","globalFilter","rows","pagination","loading","cols","list","showNewButton","onLazyLoad","onRowSelect","onNewClick"],["pTemplate","body"],["class","text-center",3,"ngSwitch","width",4,"ngFor","ngForOf"],[1,"text-center",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["styleClass","p-col-12",3,"image","label"],[1,"text-center"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"table-card",1),e.NdJ("onLazyLoad",function(l){return a.onLazyLoad(l)})("onRowSelect",function(l){return a.onRowSelect(l)})("onNewClick",function(){return a.onNew()}),e.YNc(2,R,1,1,"ng-template",2),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("reloading",a.loading)("globalFilter",a.globalFilter)("rows",a.rows)("pagination",a.pagination)("loading",a.loading)("cols",a.cols)("list",a.list)("showNewButton",a.user.id_rolUsuario!==a.USER))},dependencies:[r.sg,r.RF,r.n9,r.ED,U.r,T.jx,g.A,r.rS,r.uU],encapsulation:2}),o})();var J=i(2959),p=i(8203),h=i(9615),_=i(8683),f=i(9226),S=i(9283),x=i(5722),c=i(433),w=i(5593),P=i(1795),C=i(585),I=i(7011),Z=i(3026);function F(o,n){1&o&&e._UZ(0,"app-loading",3)}function Q(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"label"),e._uU(2,"Estado:"),e.qZA(),e.TgZ(3,"p-multiSelect",19),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw(2);return e.KtG(l.exemplarStatusSelect.selectedStatus=s)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("options",t.exemplarStatusSelect.status)("ngModel",t.exemplarStatusSelect.selectedStatus)("showToggleAll",!1)("resetFilterOnHide",!0)("disabled",!0)}}function H(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",20)(1,"button",21),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.delete())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("loading",t.deleteLoading)}}const j=function(o){return{"p-sm-12":o}},G=function(o,n){return{"p-col-6 p-sm-9":o,"p-col-12":n}};function Y(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"form",4,5)(2,"div",6)(3,"label"),e._uU(4,"Ejemplar:"),e.qZA(),e.TgZ(5,"p-multiSelect",7,8),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.selectedExemplar=s)})("onFilter",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.exemplarFilter(s))})("onChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.exemplarChange(s))}),e.qZA()(),e.TgZ(7,"div",6)(8,"label"),e._uU(9,"Usuario:"),e.qZA(),e.TgZ(10,"p-multiSelect",9,10),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.selectedUser=s)})("onFilter",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.userFilter(s))})("onChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.userSelect.userChange(s))}),e.qZA()(),e.TgZ(12,"div",11)(13,"label"),e._uU(14,"Rango de fechas:"),e.qZA(),e.TgZ(15,"p-calendar",12),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.exemplarSelect.dates=s)})("onSelect",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onDateChange())}),e.qZA()(),e.YNc(16,Q,4,5,"div",13),e.TgZ(17,"div",14)(18,"div",15)(19,"button",16),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.add())}),e.ALo(20,"addOrEdit"),e.qZA()(),e.YNc(21,H,2,1,"div",17),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("options",t.exemplarSelect.exemplars)("ngModel",t.exemplarSelect.selectedExemplar)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!t.isNew),e.xp6(5),e.Q6J("options",t.userSelect.users)("ngModel",t.userSelect.selectedUser)("showToggleAll",!1)("showClear",!0)("resetFilterOnHide",!0)("disabled",!t.isNew),e.xp6(2),e.Q6J("ngClass",e.VKq(26,j,t.isNew)),e.xp6(3),e.Q6J("disabledDates",t.exemplarSelect.disabledDates)("ngModel",t.exemplarSelect.dates)("minDate",t.minDate)("maxDate",t.maxDate)("selectOtherMonths",!0),e.xp6(1),e.Q6J("ngIf",!t.isNew),e.xp6(2),e.Q6J("ngClass",e.WLB(28,G,t.user.id_rolUsuario===t.SUPER_ADMIN&&!t.isNew,t.isNew||t.user.id_rolUsuario!==t.SUPER_ADMIN)),e.xp6(1),e.Q6J("loading",t.addLoading)("label",e.lcZ(20,24,t.isNew))("disabled",!t.formIsValid),e.xp6(2),e.Q6J("ngIf",t.user.id_rolUsuario===t.SUPER_ADMIN&&!t.isNew)}}let b=(()=>{class o extends J.H{constructor(t,a,s,l){super(),this.route=t,this.userSelect=a,this.exemplarSelect=s,this.exemplarStatusSelect=l,this.SUPER_ADMIN=d.G.SUPER_ADMIN,this.isNew=!0,this.minDate=new Date,this.addLoading=!1,this.deleteLoading=!1}get formIsValid(){return this.userSelect.selectedUser?.length>0&&this.exemplarSelect.selectedExemplar?.length>0&&null!==this.exemplarSelect.dates[0]&&null!==this.exemplarSelect.dates[1]}ngOnInit(){this.loadAll(),this.user=this.authService.storagedUser,this.breadcrumbService.setItems(this.getBreadCrumbs())}loadAll(){this.user.id_rolUsuario===d.G.USER&&(this.messageService.setPayload({type:"warn",title:"Error",body:"No tienes autorizaci\xf3n para ver esta informaci\xf3n"}),setTimeout(()=>{this.router.navigate([p.u.borrowsPage])},50)),this.subscription.add(this.route.params.subscribe(({id:t})=>{this.loading=!0,this.exemplarSelect.loadExemplars(),this.userSelect.loadUsers(),this.exemplarStatusSelect.loadStatus(),t?(this.id=t,this.loadInfo()):this.loading=!1}))}loadInfo(){this.subscription.add(this.catalogService.getByNameWithParams(`PRESTAMO/${this.id}`).subscribe(t=>{t&&(this.isNew=!1),this.id=t.id_Prestamo,this.exemplarSelect.dates=[new Date(t.fh_Prestamo),new Date(t.fh_Devolucion)],this.maxDate=new Date(t.fh_Devolucion),this.minDate=new Date(t.fh_Prestamo),this.userSelect.selectedUser=[t.USUARIO.id_Usuario],this.exemplarSelect.selectedExemplar=[t.EJEMPLAR.id_Ejemplar],this.exemplarStatusSelect.selectedStatus=[t.ESTADOS.id_Estado],this.exemplarStatusSelect.loadedStatus=t.ESTADOS.id_Estado,setTimeout(()=>{this.loading=!1},200)},()=>{this.loading=!1,this.router.navigate([p.u.borrowsPage])}))}add(){this.isNew?(this.addLoading=!0,this.subscription.add(this.catalogService.addOfURL("PRESTAMO",{fh_Prestamo:this.exemplarSelect.dates[0],fh_Devolucion:this.exemplarSelect.dates[1],id_Estado:h.u.EN_PRESTAMO,id_usuarioPresta:this.userSelect.selectedUser[0],id_Ejemplar:this.exemplarSelect.selectedExemplar[0]}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"El pr\xe9stamo fue a\xf1adido satifactoriamente"}),setTimeout(()=>{this.router.navigate([p.u.borrowsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo a\xf1adir el pr\xe9stamo"}),this.addLoading=!1}))):this.update()}update(){this.addLoading=!0,this.subscription.add(this.catalogService.updateOfURL(`PRESTAMO/${this.id}`,{id_Prestamo:this.id,fh_Prestamo:this.exemplarSelect.dates[0],fh_Devolucion:this.exemplarSelect.dates[1],id_usuarioPresta:this.userSelect.selectedUser[0],id_Estado:this.exemplarStatusSelect.selectedStatus[0],id_Ejemplar:this.exemplarSelect.selectedExemplar[0]}).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"El pr\xe9stamo fue editado satifactoriamente"}),setTimeout(()=>{this.router.navigate([p.u.borrowsPage])},200),this.addLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo editar el pr\xe9stamo"}),this.addLoading=!1}))}delete(){this.deleteLoading=!0,this.subscription.add(this.catalogService.deleteOfURL(`PRESTAMO/${this.id}`).subscribe(()=>{this.messageService.setPayload({type:"success",title:"\xa1Exito!",body:"El pr\xe9stamo fue eliminado con \xe9xito"}),setTimeout(()=>{this.router.navigate([p.u.borrowsPage])},200),this.deleteLoading=!1},()=>{this.messageService.setPayload({type:"warn",title:"Error",body:"No se pudo eliminar el pr\xe9stamo"}),this.deleteLoading=!1}))}onDateChange(){if(null===this.exemplarSelect.dates[0]||null===this.exemplarSelect.dates[1])return;this.isNew||(this.exemplarStatusSelect.selectedStatus=this.exemplarSelect.dates[1]<this.maxDate?[h.u.FINALIZADO]:[this.exemplarStatusSelect.loadedStatus]);let t=[];const a=new Date(this.exemplarSelect.dates[0].getTime());for(;this.exemplarSelect.dates[1]>a||this.exemplarSelect.dates[1].getDate()===a.getDate();)t.push(new Date(a.getDate())),a.setDate(a.getDate()+1);t.forEach(s=>{this.exemplarSelect.disabledDates.forEach(l=>{s.getDate()!==l.getDate()||(this.exemplarSelect.dates=[])})})}getBreadCrumbs(){return[{label:"Pr\xe9stamos",routerLink:[this.routeInformation.borrowsPage]},{label:"Pr\xe9stamo",routerLink:[this.routeInformation.borrowPage]}]}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.gz),e.Y36(_.q),e.Y36(f.D),e.Y36(S.a))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-borrows-page"]],features:[e.qOj],decls:3,vars:2,consts:[[1,"card","p-mt-4"],["class","p-d-flex p-ai-center p-jc-center","style","height: 80%",4,"ngIf"],["autocomplete","off","class","p-fluid p-formgrid p-grid p-formgrid-sm p-ml-2 p-mr-2",4,"ngIf"],[1,"p-d-flex","p-ai-center","p-jc-center",2,"height","80%"],["autocomplete","off",1,"p-fluid","p-formgrid","p-grid","p-formgrid-sm","p-ml-2","p-mr-2"],["form","ngForm"],[1,"p-field","p-col-12","p-mt-2"],["name","selectedType","defaultLabel","Elige un ejemplar","optionLabel","nombre","optionValue","id_Ejemplar","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],["exemplarMultiSelect",""],["name","selectedUser","defaultLabel","Elige un usuario","optionLabel","nombre","optionValue","id_Usuario","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","showClear","resetFilterOnHide","disabled","ngModelChange","onFilter","onChange"],["userMultiSelect",""],[1,"p-field","p-col-12","p-sm-6","p-mt-2",3,"ngClass"],["selectionMode","range","name","dates","dateFormat","dd/mm/yy","placeholder","Elige un rango de fechas para tu pr\xe9stamo",3,"disabledDates","ngModel","minDate","maxDate","selectOtherMonths","ngModelChange","onSelect"],["class","p-field p-col-12 p-sm-6 p-mt-2",4,"ngIf"],[1,"p-col-12","p-grid","p-mt-4","p-ml-0","p-mr-0","p-pl-0","p-pr-0"],[1,"p-field",3,"ngClass"],["pButton","","pRipple","","type","button",1,"p-button-success",3,"loading","label","disabled","click"],["class","p-field p-col-6 p-sm-3",4,"ngIf"],[1,"p-field","p-col-12","p-sm-6","p-mt-2"],["name","selectedStatus","defaultLabel","Elige un estado","optionLabel","estado","optionValue","id_Estado","emptyFilterMessage","No se encontraron resultados",3,"options","ngModel","showToggleAll","resetFilterOnHide","disabled","ngModelChange"],[1,"p-field","p-col-6","p-sm-3"],["pButton","","pRipple","","type","button","label","Eliminar","icon","pi pi-trash",1,"p-button-danger",3,"loading","click"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0),e.YNc(1,F,1,0,"app-loading",1),e.YNc(2,Y,22,31,"form",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",a.loading),e.xp6(1),e.Q6J("ngIf",!a.loading))},dependencies:[r.mk,r.O5,x.NU,c._Y,c.JJ,c.JL,c.On,c.F,w.Hq,P.H,C.f,I.N,Z.p],encapsulation:2}),o})();const K=[{path:"",component:O},{path:"borrow",component:b},{path:"borrow/:id",component:b}];let z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.Bz.forChild(K),m.Bz]}),o})();var $=i(6311),E=i(4466),V=i(9423);let W=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[_.q,f.D,S.a],imports:[r.ez,z,$.j,E.m,x.q4,c.u5,w.hJ,P.T,E.m,C._8,V.I,g.o]}),o})()}}]);